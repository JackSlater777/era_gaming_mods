ZVSE
ERMS_ScriptDate=12.11(November).2012
_WARNING_#1=IMPORTANT! This file is not in a plain text format. NEVER use any editor except ERM_S for making any kind of changes!
ERMS_PoweredBy=ERM Scripter v. 2004.10.5.945
** Author orig.  : igrik, Algor
** Name          : Heroes without armies
** Name rus.     : Герои без армий
** Options       : 728
** Dialogs       : -
** Variables     : -
** Tmp variables : -
** Timers        : TM50(standard)
** Functions     : FU7919
** PO-values     : -

** Включение опции разрешает передавать/увольнять все войска и оставлять героев без армии
** Герои без армий в начале дня получают 25% штраф передвижения (аналог штрафу за наличие в армии существ со скоростью 3)

!#TM50:S2/999/1/255;             [каждый день для всех игроков начиная со 2го дня]

!?FU(OnAfterErmInstructions);           [при старте игры]
!!UN:P728/?y1;
** запрет роспуска последнего отряда
!!UN&y1=0:C5102718/4/2114058371 C5102722/1/12 C5961680/2/40719 C5961682/1/194 C6115569/4/2114058371 C6115573/1/7 C6115641/4/2114058371 C6115645/1/7;
** запрет передачи последнего отряда
!!UN&y1=0:C5968130/4/14844943 C5968134/2/0 C5968202/1/117 C6060664/1/116 C6117225/1/117 C7703532/2/3189 C7703637/2/3189 C7705318/2/3189 C7705430/2/3189 C6060065/2/27368;
** разрешение роспуска последнего отряда
!!UN&y1>0:C5102718/4/2425393296 C5102722/1/144 C5961680/2/434 C5961682/1/144 C6115569/4/2425393296 C6115573/1/144 C6115641/4/2425393296 C6115645/1/144;
** разрешение передачи последнего отряда
!!UN&y1>0:C5968130/4/2425393296 C5968134/2/37008 C5968202/1/235 C6060664/1/235 C6117225/1/235 C7703532/2/3307 C7703637/2/3307 C7705318/2/3307 C7705430/2/3307 C6060065/2/27320;

!?FU(OnAfterLoadGame);                  [при загрузке игры]
!!UN:P728/?y1;
** запрет роспуска последнего отряда
!!UN&y1=0:C5102718/4/2114058371 C5102722/1/12 C5961680/2/40719 C5961682/1/194 C6115569/4/2114058371 C6115573/1/7 C6115641/4/2114058371 C6115645/1/7;
** запрет передачи последнего отряда
!!UN&y1=0:C5968130/4/14844943 C5968134/2/0 C5968202/1/117 C6060664/1/116 C6117225/1/117 C7703532/2/3189 C7703637/2/3189 C7705318/2/3189 C7705430/2/3189 C6060065/2/27368;
** разрешение роспуска последнего отряда
!!UN&y1>0:C5102718/4/2425393296 C5102722/1/144 C5961680/2/434 C5961682/1/144 C6115569/4/2425393296 C6115573/1/144 C6115641/4/2425393296 C6115645/1/144;
** разрешение передачи последнего отряда
!!UN&y1>0:C5968130/4/2425393296 C5968134/2/37008 C5968202/1/235 C6060664/1/235 C6117225/1/235 C7703532/2/3307 C7703637/2/3307 C7705318/2/3307 C7705430/2/3307 C6060065/2/27320;

!?TM50;                          [каждый день для всех игроков начиная со 2го дня]
!!UN:P728/?y1; !!FU&y1=0:E;      [выход, если опция не включена]
!!OW:C?y1 Hy1/1/0; !!VRy2:Sv1;   [y1/y2 - текущий игрок/кол-во героев текущего игрока]
!!DO7919/1/y2/1&y2>0:Py1;        [перебираем героев игрока и штрафуем за отсутствие армий]

!?FU7919;                        [для каждого героя игрока x1 получаем сумму уровней Экономики в v942 а стандартный прирост золота от Поместий в v944]
!!OW:Hx1/1/x16; !!VRy8:Sv1;      [y8 - номер героя]
!!HEy8:C0/0/d/?y1 C0/1/d/?y2 C0/2/d/?y3 C0/3/d/?y4 C0/4/d/?y5 C0/5/d/?y6 C0/6/d/?y7;
!!VRy1:+y2 +y3 +y4 +y5 +y6 +y7;  [y1 - общая численность армии героя]
!!FU&y1>0:E;                     [выход, если у героя есть армия]
!!HEy8:P?y1/?y1/?y3;             [y1/y2/y3 - координаты героя]
!!TRy1/y2/y3:T?y4/d/d/d/d/d/d/d; [y4 - тип почвы под героем]
!!FU&y4=8:E;                     [выход, если герой на воде]
!!HEy8:G?y1 W?y2/1; !!VRy3:Sy1:4;[y1 - макс. запас хода, y2 - текущий запас хода, y3 - штраф (25% запаса хода)]
!!VRy4:Sy2 -y3; !!VRy4&y4<0:S0;  [y4 - новый текущий запас хода]
!!HEy8:Wy4/1; !!HEy8&y1=y2:Gy4;  [установка нового текущего запаса, и, если ходы не тратились, начального, чтобы герой без армии мог копать]

** end
